# ğŸ¤– Claude API å®æˆ˜é¡¹ç›®

> åŸºäºç¬¬2è¯¾å†…å®¹æ„å»ºçš„å®Œæ•´Node.jså®æˆ˜é¡¹ç›® - æ™ºèƒ½å¯¹è¯å­¦ä¹ åŠ©æ‰‹
>
> ç°å·²æ”¯æŒ **æ™ºè°±AI GLM-4.7 æ¨¡å‹** å’Œ **Web ç•Œé¢**ï¼

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Claude APIå®æˆ˜åº”ç”¨ï¼Œç»¼åˆè¿ç”¨äº†è¯¾ç¨‹ä¸­å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œå¹¶æ‰©å±•æ”¯æŒï¼š

- âœ… Anthropic APIé…ç½®å’Œè®¤è¯
- âœ… **æ™ºè°±AI GLM-4.7 æ¨¡å‹æ”¯æŒï¼ˆå…¼å®¹APIï¼‰**
- âœ… å¯¹è¯ä¸Šä¸‹æ–‡å’Œå†å²ç®¡ç†
- âœ… Tokenè®¡ç®—å’Œæˆæœ¬æ§åˆ¶
- âœ… æ™ºèƒ½ç¼“å­˜ä¼˜åŒ–
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… å‘½ä»¤è¡Œäº¤äº’ç•Œé¢ï¼ˆCLIï¼‰
- âœ… **Web ç•Œé¢ï¼ˆExpress + æµå¼å“åº”ï¼‰**

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ’¬ **å¤šæ¨¡å¼å¯¹è¯** | æ”¯æŒç¼–ç¨‹åŠ©æ‰‹ã€å­¦ä¹ åŠ©æ‰‹ã€å†™ä½œåŠ©æ‰‹ã€ç¿»è¯‘åŠ©æ‰‹å››ç§æ¨¡å¼ |
| ğŸ“Š **Tokenè¿½è¸ª** | å®æ—¶è¿½è¸ªTokenä½¿ç”¨æƒ…å†µï¼Œè‡ªåŠ¨è®¡ç®—APIè°ƒç”¨æˆæœ¬ |
| ğŸ’° **é¢„ç®—æ§åˆ¶** | è®¾ç½®é¢„ç®—ä¸Šé™ï¼Œé˜²æ­¢æ„å¤–è¶…æ”¯ |
| ğŸ’¾ **æ™ºèƒ½ç¼“å­˜** | ç¼“å­˜å¸¸è§é—®ç­”ï¼Œå‡å°‘APIè°ƒç”¨ï¼ŒèŠ‚çœæˆæœ¬ |
| ğŸ“ **å¯¹è¯ä¿å­˜** | æ”¯æŒä¿å­˜å¯¹è¯å†å²ï¼Œå¯å¯¼å‡ºä¸ºJSONæˆ–TXTæ ¼å¼ |
| ğŸ“ˆ **è¯¦ç»†æŠ¥å‘Š** | ç”Ÿæˆè¯¦ç»†çš„ä½¿ç”¨æŠ¥å‘Šå’Œæˆæœ¬åˆ†æ |

### å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `/help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/status` | æŸ¥çœ‹å½“å‰çŠ¶æ€ |
| `/mode [åç§°]` | åˆ—å‡º/åˆ‡æ¢åŠ©æ‰‹æ¨¡å¼ |
| `/clear` | æ¸…ç©ºå¯¹è¯å†å² |
| `/save` | ä¿å­˜å½“å‰å¯¹è¯ |
| `/report` | æ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Š |
| `/cache` | æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡ |
| `/reset` | é‡ç½®ä¼šè¯ |
| `/quit` | é€€å‡ºç¨‹åº |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 9.0.0
- Anthropic API Key

### 2. å®‰è£…æ­¥éª¤

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd claude-api-practical-project

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
```

### 3. é…ç½®API Key

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„API Keyï¼š

```env
ANTHROPIC_API_KEY=sk-ant-api03-ä½ çš„API-Key

# å¯é€‰é…ç½®
DEFAULT_MODEL=claude-3-5-sonnet-20241022
DEFAULT_MAX_TOKENS=1024
BUDGET_LIMIT=0.50
ENABLE_CACHE=true
```

### 4. è¿è¡Œåº”ç”¨

```bash
# CLIæ¨¡å¼å¯åŠ¨
npm start

# æˆ–ä½¿ç”¨å¼€å‘æ¨¡å¼ï¼ˆNode.js 18.17+ï¼‰
npm run dev

# Webæ¨¡å¼å¯åŠ¨ï¼ˆæ–°å¢ï¼‰
npm run web
```

è®¿é—® http://localhost:3000 ä½¿ç”¨Webç•Œé¢ã€‚

### 4.1 é…ç½®æ™ºè°±AIï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œä½¿ç”¨æ™ºè°±AIçš„å…¼å®¹APIï¼š

```env
# æ™ºè°±AIé…ç½®
ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic
ANTHROPIC_AUTH_TOKEN=ä½ çš„æ™ºè°±AI-Token
DEFAULT_MODEL=GLM-4.7
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
claude-api-practical-project/
â”œâ”€â”€ config.js                    # å…¨å±€é…ç½®
â”œâ”€â”€ package.json                 # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js                 # ä¸»å…¥å£æ–‡ä»¶ï¼ˆCLIåº”ç”¨ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ conversation-manager.js    # å¯¹è¯ç®¡ç†å™¨ï¼ˆæ”¯æŒæµå¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ token-tracker.js           # Tokenè¿½è¸ªå™¨
â”‚   â”‚   â””â”€â”€ cache-manager.js           # ç¼“å­˜ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ clever-assistant.js        # æ™ºèƒ½åŠ©æ‰‹æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                  # WebæœåŠ¡å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ server.js                # ExpressæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â””â”€â”€ chat.js              # APIè·¯ç”±
â”‚   â”‚
â”‚   â””â”€â”€ utils/                   # å·¥å…·ç±»
â”‚       â””â”€â”€ logger.js                   # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€â”€ public/                      # Webå‰ç«¯èµ„æºï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ index.html                   # Webç•Œé¢
â”‚   â”œâ”€â”€ style.css                    # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ app.js                       # å‰ç«¯é€»è¾‘
â”‚
â”œâ”€â”€ data/                        # æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ *.json                   # ä¿å­˜çš„å¯¹è¯
â”‚   â””â”€â”€ cache.json               # ç¼“å­˜æ–‡ä»¶
â”‚
â””â”€â”€ logs/                        # æ—¥å¿—ç›®å½•
    â””â”€â”€ app-*.log                # åº”ç”¨æ—¥å¿—
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å¯¹è¯

```
ğŸ‘¤ ä½  [å­¦ä¹ åŠ©æ‰‹]> è¯·è§£é‡Šä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ

ğŸ¤– Claude: é—­åŒ…ï¼ˆClosureï¼‰æ˜¯JavaScriptä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µ...

â””â”€ Tokens: 856 | æˆæœ¬: $0.000015
```

### åˆ‡æ¢æ¨¡å¼

```
ğŸ‘¤ ä½  [å­¦ä¹ åŠ©æ‰‹]> /mode

å¯ç”¨æ¨¡å¼:
  â†’ learning    - å­¦ä¹ åŠ©æ‰‹
    coding      - ç¼–ç¨‹åŠ©æ‰‹
    writing     - å†™ä½œåŠ©æ‰‹
    translator  - ç¿»è¯‘åŠ©æ‰‹

ä½¿ç”¨ /mode <åç§°> åˆ‡æ¢æ¨¡å¼

ğŸ‘¤ ä½  [å­¦ä¹ åŠ©æ‰‹]> /mode coding
âœ“ å·²åˆ‡æ¢åˆ°ç¼–ç¨‹åŠ©æ‰‹æ¨¡å¼
```

### æŸ¥çœ‹çŠ¶æ€

```
ğŸ‘¤ ä½  [ç¼–ç¨‹åŠ©æ‰‹]> /status

============================================================
ğŸ¤– åŠ©æ‰‹çŠ¶æ€
============================================================
   å½“å‰æ¨¡å¼: ç¼–ç¨‹åŠ©æ‰‹ (coding)
   å¯¹è¯è½®æ•°: 5
   è¯·æ±‚æ¬¡æ•°: 5
   æ€»Tokens: 4,280
   å½“å‰æˆæœ¬: $0.000075
   ç¼“å­˜å‘½ä¸­ç‡: 20.00%
============================================================
```

### è¯¦ç»†æŠ¥å‘Š

```
ğŸ‘¤ ä½  [ç¼–ç¨‹åŠ©æ‰‹]> /report

ğŸ“Š è¯¦ç»†æŠ¥å‘Š

å¯¹è¯ç»Ÿè®¡:
  ä¼šè¯ID: session-1738849200000-abc123
  å¯¹è¯è½®æ•°: 5
  æ¶ˆæ¯æ•°: 10

Tokenç»Ÿè®¡:
  è¯·æ±‚æ¬¡æ•°: 5
  æ€»Tokens: 4,280
  æ€»æˆæœ¬: $0.000075
  å‰©ä½™é¢„ç®—: $0.499925

ç¼“å­˜ç»Ÿè®¡:
  å®¹é‡: 8 / 100
  å‘½ä¸­ç‡: 20.00%
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | ç‰¹ç‚¹ | è¾“å…¥æˆæœ¬ | è¾“å‡ºæˆæœ¬ |
|------|------|----------|----------|
| Claude 3.5 Sonnet | æœ€æ–°ç‰ˆæœ¬ï¼Œæ€§èƒ½å¹³è¡¡ | $3/ç™¾ä¸‡ | $15/ç™¾ä¸‡ |
| Claude 3 Opus | èƒ½åŠ›æœ€å¼ºï¼Œæˆæœ¬é«˜ | $15/ç™¾ä¸‡ | $75/ç™¾ä¸‡ |
| Claude 3 Haiku | é€Ÿåº¦å¿«ï¼Œæˆæœ¬ä½ | $0.25/ç™¾ä¸‡ | $1.25/ç™¾ä¸‡ |
| **GLM-4.7** | **æ™ºè°±AIï¼Œæ€§ä»·æ¯”é«˜** | **$0.5/ç™¾ä¸‡** | **$0.5/ç™¾ä¸‡** |

### åŠ©æ‰‹æ¨¡å¼

| æ¨¡å¼ | ç³»ç»Ÿæç¤º | Temperature | Max Tokens |
|------|----------|-------------|------------|
| learning | å‹å¥½çš„å­¦ä¹ åŠ©æ‰‹ | 0.7 | 1000 |
| coding | ä¸“ä¸šç¼–ç¨‹åŠ©æ‰‹ | 0.3 | 1500 |
| writing | å†™ä½œæ”¹è¿›åŠ©æ‰‹ | 0.8 | 1200 |
| translator | ä¸­è‹±ç¿»è¯‘åŠ©æ‰‹ | 0.2 | 800 |

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### Web ç•Œé¢ï¼ˆæ–°å¢ï¼‰

å¯åŠ¨ Web æœåŠ¡å™¨åï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š

- **ChatGPT é£æ ¼ç•Œé¢**ï¼šç®€æ´ç°ä»£çš„èŠå¤©ç•Œé¢
- **å®æ—¶æµå¼å“åº”**ï¼šä½¿ç”¨ SSE å®ç°æ‰“å­—æ•ˆæœ
- **æ¨¡å¼åˆ‡æ¢**ï¼šåœ¨ç•Œé¢ä¸Šç›´æ¥åˆ‡æ¢åŠ©æ‰‹æ¨¡å¼
- **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶æŸ¥çœ‹ Token ä½¿ç”¨å’Œæˆæœ¬
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒç§»åŠ¨ç«¯è®¿é—®

API ç«¯ç‚¹ï¼š

```
POST /api/chat          - å‘é€æ¶ˆæ¯ï¼ˆéæµå¼ï¼‰
POST /api/chat/stream   - å‘é€æ¶ˆæ¯ï¼ˆæµå¼ SSEï¼‰
GET  /api/status        - è·å–çŠ¶æ€
GET  /api/modes         - è·å–å¯ç”¨æ¨¡å¼
POST /api/mode/:mode    - åˆ‡æ¢æ¨¡å¼
POST /api/clear         - æ¸…ç©ºå†å²
GET  /api/report        - è·å–æŠ¥å‘Š
POST /api/reset         - é‡ç½®ä¼šè¯
GET  /health            - å¥åº·æ£€æŸ¥
```

### å¯¹è¯ç®¡ç†

ConversationManager è´Ÿè´£ç®¡ç†å¯¹è¯å†å²ï¼Œç»´æŠ¤å¤šè½®å¯¹è¯çš„ä¸Šä¸‹æ–‡ï¼š

```javascript
// è‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²
await assistant.sendMessage("æˆ‘å«å°æ˜");
await assistant.sendMessage("æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"); // èƒ½æ­£ç¡®å›ç­”
```

### Tokenè¿½è¸ª

TokenTracker å®æ—¶è¿½è¸ªAPIä½¿ç”¨æƒ…å†µï¼š

```javascript
// è‡ªåŠ¨è®°å½•æ¯æ¬¡APIè°ƒç”¨
tokenTracker.recordCall(inputTokens, outputTokens, model);

// è·å–æˆæœ¬æŠ¥å‘Š
const report = tokenTracker.getReport();
console.log(`å½“å‰æˆæœ¬: $${report.summary.totalCost}`);
```

### æ™ºèƒ½ç¼“å­˜

CacheManager ä½¿ç”¨LRUç­–ç•¥ç¼“å­˜APIå“åº”ï¼š

```javascript
// è‡ªåŠ¨ç¼“å­˜ç›¸åŒé—®é¢˜çš„å›å¤
const response1 = await assistant.sendMessage("ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ");
const response2 = await assistant.sendMessage("ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ"); // æ¥è‡ªç¼“å­˜
```

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„åŠ©æ‰‹æ¨¡å¼

ç¼–è¾‘ `src/services/clever-assistant.js`ï¼š

```javascript
const ASSISTANT_PRESETS = {
    // ... ç°æœ‰æ¨¡å¼
    custom: {
        name: 'è‡ªå®šä¹‰åŠ©æ‰‹',
        systemPrompt: 'ä½ çš„è‡ªå®šä¹‰ç³»ç»Ÿæç¤º',
        temperature: 0.5,
        maxTokens: 1000
    }
};
```

### è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
LOG_LEVEL=debug  # debug | info | warn | error
```

## ğŸ“– è¯¾ç¨‹å¯¹åº”

æœ¬é¡¹ç›®å®ç°äº†ç¬¬2è¯¾çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œå¹¶è¿›è¡Œäº†æ‰©å±•ï¼š

| è¯¾ç¨‹å†…å®¹ | é¡¹ç›®å®ç° | æ‰©å±•åŠŸèƒ½ |
|----------|----------|----------|
| ç¯å¢ƒæ­å»ºä¸APIé…ç½® | `config.js`, `.env` | æ™ºè°±AIå…¼å®¹é…ç½® |
| ç¬¬ä¸€ä¸ªAPIè°ƒç”¨ | `ConversationManager.chat()` | æµå¼å“åº”æ”¯æŒ |
| ç†è§£APIå‚æ•° | `ConversationManager` æ„é€ å‡½æ•° | è‡ªå®šä¹‰ baseURL |
| å¯¹è¯ç®¡ç†ä¸ä¸Šä¸‹æ–‡ | `ConversationManager` | Webä¼šè¯ç®¡ç† |
| Tokenå’Œæˆæœ¬è®¡ç®— | `TokenTracker` | GLM-4.7ä»·æ ¼é…ç½® |
| ä¼˜åŒ–ç­–ç•¥ | `CacheManager` | - |
| - | - | Express WebæœåŠ¡å™¨ |
| - | - | SSE æµå¼å“åº” |
| - | - | ChatGPTé£æ ¼å‰ç«¯ç•Œé¢ |

æœ¬é¡¹ç›®å®ç°äº†ç¬¬2è¯¾çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼š

| è¯¾ç¨‹å†…å®¹ | é¡¹ç›®å®ç° |
|----------|----------|
| ç¯å¢ƒæ­å»ºä¸APIé…ç½® | `config.js`, `.env` |
| ç¬¬ä¸€ä¸ªAPIè°ƒç”¨ | `ConversationManager.chat()` |
| ç†è§£APIå‚æ•° | `ConversationManager` æ„é€ å‡½æ•° |
| å¯¹è¯ç®¡ç†ä¸ä¸Šä¸‹æ–‡ | `ConversationManager` |
| Tokenå’Œæˆæœ¬è®¡ç®— | `TokenTracker` |
| ä¼˜åŒ–ç­–ç•¥ | `CacheManager` |

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤º"æœªæ‰¾åˆ°API Key"**

A: ç¡®ä¿å·²åˆ›å»º `.env` æ–‡ä»¶å¹¶æ­£ç¡®é…ç½® `ANTHROPIC_API_KEY`

**Q: è¶…å‡ºé¢„ç®—é™åˆ¶**

A: ä½¿ç”¨ `/reset` å‘½ä»¤é‡ç½®ä¼šè¯ï¼Œæˆ–åœ¨ `.env` ä¸­å¢åŠ  `BUDGET_LIMIT`

**Q: ä¾èµ–å®‰è£…å¤±è´¥**

A: å°è¯•åˆ é™¤ `node_modules` å’Œ `package-lock.json`ï¼Œé‡æ–°è¿è¡Œ `npm install`

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäº Anthropic Claude API è¯¾ç¨‹å†…å®¹æ„å»ºã€‚

---

**ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸš€**
